<div class="maindiv">
    <h2 class="pt-3 text-center">Editer mon compte</h2>
    <form (ngSubmit)="onSubmit()" [formGroup]="editRegisterForm" class="form">

        <div>
            <h5 class="border-top">Mes coordonnées </h5>
            <!-- Titre-->
            <div class="form-group">
                <label for="CustomerTitre">Titre</label>
                <select class="form-control" formControlName="CustomerTitre" autofocus
                    [ngClass]="{ 'is-invalid': submitted && f.CustomerTitre.errors || f.CustomerTitre.touched && f.CustomerTitre.errors}">
                    <option value="" selected disabled>Veuillez choisir</option>
                    <option value="Mme">Mme</option>
                    <option value="Mr">Mr</option>
                    <option value="NB">Non binaire</option>
                </select>
            </div>

            <!-- First name-->
            <div class="row">
                <div class="col-sm">
                    <div class="form-group">
                        <label for="CustomerName">Prénom</label>
                        <input type="text" maxlength="100" formControlName="CustomerName" class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && f.CustomerName.errors || f.CustomerName.touched && f.CustomerName.errors}" />
                        <div class="invalid-feedback" *ngIf=" f.CustomerName.hasError('pattern')">
                            Uniquement des lettres et des espaces</div>
                    </div>
                </div>
                <!-- Last name-->
                <div class="col-sm">
                    <div class="form-group">
                        <label for="CustomerLastName">Nom</label>
                        <input type="text" maxlength="100" formControlName="CustomerLastName" class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && f.CustomerLastName.errors || f.CustomerLastName.touched && f.CustomerLastName.errors}" />
                        <div class="invalid-feedback" *ngIf="submitted && f.CustomerLastName.hasError('pattern')">
                            Uniquement des lettres et des espaces</div>
                    </div>
                </div>

            </div>

            <!-- Birthday date-->
            <div class="form-group">
                <label for="CustomerBirthday">Date de naissance</label>
                <input onfocus="(this.type='date')" type="text" formControlName="CustomerBirthday" class="form-control"
                    placeholder=""
                    [ngClass]="{ 'is-invalid': submitted && f.CustomerBirthday.errors || f.CustomerBirthday.touched && f.CustomerBirthday.errors}" />
            </div>


            <!-- Adresse de livraison -->
            <h6 class="border-top pt-3">
                <svg class="f-icon " aria-hidden="true" role="img" focusable="false" height="20"
                    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="icon_i_027_location">
                    <path fill="currentColor" d="M16 3.1a7.04 7.04 0 017.03 7.04c0 4.47-4.66 11.77-7.03 15.75-4-6.74-7.03-11.9-7.03-15.75A7.04
                                 7.04 0 0116 3.1zM16 0C10.4 0 5.86 4.54 5.86 10.14S10.3 22.24 16 32c5.7-9.76 10.14-16.27 10.14-21.86S21.6
                                  0 16 0zm0 6.52a3.52 3.52 0 100 7.04 3.52 3.52 0 000-7.04z">
                    </path>
                </svg>
                Adresse de livraison</h6>
            <div>
                <!-- Adresse-->
                <div class="form-group">
                    <label for="ShippingAddress">Rue, n°</label>
                    <input id="shippingAddress" type="text" formControlName="shippingAddress" class="form-control"
                        [ngClass]="{ 'is-invalid': submitted && f.shippingAddress.errors || f.shippingAddress.touched && f.shippingAddress.errors}" />
                </div>
                <!-- Ville-->
                <div class="row">
                    <div class="col-sm">
                        <div class="form-group">
                            <label for="shippingCity">Ville</label>
                            <input type="text" maxlength="100" formControlName="shippingCity" id="shippingCity"
                                class="form-control"
                                [ngClass]="{ 'is-invalid': submitted && f.shippingCity.errors  || f.shippingCity.touched && f.shippingCity.errors}" />
                        </div>
                    </div>
                    <!-- NPA-->
                    <div class="col-sm">
                        <div class="form-group">
                            <label for="shippingZip">Code Postal</label>
                            <input maxlength="4" formControlName="shippingZip" class="form-control" id="shippingZip"
                                [ngClass]="{ 'is-invalid': submitted && f.shippingZip.errors ||
                                             f.shippingZip.errors && f.shippingZip.hasError('pattern') || f.shippingZip.touched && f.shippingZip.errors ||
                                             f.shippingZip.touched && f.shippingZip.hasError('minLength')}" />
                            <div class="invalid-feedback"
                                *ngIf="f.shippingZip.touched && f.shippingZip.hasError('pattern') ">
                                Uniquement des chiffres</div>
                            <div class="invalid-feedback"
                                *ngIf="f.shippingZip.touched && f.shippingZip.value.length<4 && f.shippingZip.value.length!=0 ">
                                Au moins 4 chiffres</div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Adresse de facturation -->
            <h6 class="border-top pt-3">
                <svg class="f-icon " aria-hidden="true" role="img" focusable="false" height="20"
                    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="icon_i_017_postal_card">
                    <path fill="currentColor"
                        d="M16.12 15.24L5.96 18.35l.4 1.33 10.16-3.12-.4-1.32zM27.25 4.08L32 19.57 4.75 27.92
                                 0 12.43l27.25-8.35zm2.16 14.11L25.88 6.67 2.59 13.81l3.53 11.52 23.29-7.14zM7.3
                                  22.77l10.16-3.11-.4-1.32-10.16 3.1.4 1.33zm18.76-11.6l-1-3.24-2.4.74.99 3.24 2.4-.74z">
                    </path>
                </svg>
                Adresse de facturation</h6>
            <div>
                <div class="form-group">
                    <div class="custom-control custom-checkbox">
                        <input [value]="true" name="checkbox_address" id="checkbox_address" type="checkbox"
                            class="custom-control-input" formControlName="checkbox_address"
                            (change)="onSameAddressCheck()">
                        <label for="checkbox_address" class="custom-control-label">
                            Comme l'adresse de livraison.
                        </label>
                    </div>
                </div>
                <!-- Adresse-->
                <div class="form-group">
                    <label for="billingAddress">Rue, n°</label>
                    <input id="billingAddress" type="text" formControlName="billingAddress" class="form-control"
                        [ngClass]="{ 'is-invalid': submitted && f.billingAddress.errors ||f.billingAddress.touched && f.billingAddress.errors}" />
                </div>
                <!-- Ville-->
                <div class="row">
                    <div class="col-sm">
                        <div class="form-group">
                            <label for="billingCity">Ville</label>
                            <input type="text" maxlength="100" formControlName="billingCity" id="billingCity"
                                class="form-control"
                                [ngClass]="{ 'is-invalid': submitted && f.billingCity.errors ||f.billingCity.touched && f.billingCity.errors }" />
                        </div>
                    </div>
                    <!-- NPA-->
                    <div class="col-sm">
                        <div class="form-group">
                            <label for="billingZip">Code Postal</label>
                            <input maxlength="4" formControlName="billingZip" id="billingZip" class="form-control"
                                [ngClass]="{ 'is-invalid': submitted && f.billingZip.errors ||
                                         f.billingZip.touched && f.billingZip.hasError('pattern')
                                         || f.billingZip.touched && f.billingZip.errors ||
                                         f.billingZip.touched && f.billingZip.hasError('minLength')}" />
                            <div class="invalid-feedback" *ngIf="f.billingZip.touched && f.billingZip.hasError('pattern') ||
                                     f.billingZip.errors && f.billingZip.hasError('pattern')">
                                Uniquement des chiffres</div>
                            <div class="invalid-feedback"
                                *ngIf="f.billingZip.touched && f.billingZip.value.length<4 && f.billingZip.value.length!=0 ">
                                Au moins 4 chiffres</div>
                        </div>
                    </div>
                </div>
            </div>
            <h5 class="border-top">Mes informations de contact</h5>
            <div>
                <!-- Email -->
                <div class="form-group">
                    <label for="CustomerEmail">E-mail</label>
                    <input type="CustomerEmail" formControlName="CustomerEmail" class="form-control" placeholder="exemple@domaine.com"
                        [ngClass]="{ 'is-invalid': submitted && f.CustomerEmail.errors || f.CustomerEmail.touched && f.CustomerEmail.errors}" />
                    <div class="invalid-feedback"
                        *ngIf="submitted && f.CustomerEmail.hasError('CustomerEmail') || f.CustomerEmail.touched && f.CustomerEmail.hasError('CustomerEmail')">
                        Le format de la saisie n'est pas valable
                    </div>
                </div>
                <!-- Private phone-->
                <div class="form-group">
                    <label for="CustomerPhone">Téléphone privé</label>
                    <input type="phone" formControlName="CustomerPhone" class="form-control"
                        placeholder="Par exemple: +41 12 345 67 89" [ngClass]="{ 'is-invalid': submitted && f.CustomerPhone.errors || f.CustomerPhone.touched && f.CustomerPhone.errors || 
                            f.CustomerPhone.touched && f.CustomerPhone.hasError('pattern')}" />
                    <div class="invalid-feedback" *ngIf="submitted && f.CustomerPhone.hasError('pattern') ||
                             f.CustomerPhone.touched && f.CustomerPhone.hasError('pattern')">
                        Le format de la saisie n'est pas valable
                    </div>
                </div>
            </div>
        </div>


        <div>
            <h5 class="border-top">Mes identifiants </h5>
            <!-- username -->

            <label for="username">Nom d'utilisateur:</label>
            <div class="row text-center align-middle p-3">
                <div class="form-group col-sm d-inline">
                    <h5 class="font-weight-bold">
                        {{usernameData}}
                    </h5>
                </div>
                <div class="col-sm d-inline">
                    <button [ngClass]="changeUsername  ? 'text-danger' : 'text-success'" class="btn btn-light"
                        (click)="onUsernameChange()">
                        <a *ngIf="!changeUsername">Modifier</a>
                        <a *ngIf="changeUsername">Ne pas modifier</a>
                    </button>
                </div>
            </div>

            <div class="form-group" *ngIf="changeUsername">
                <label for="username">Nouveau nom d'utilisateur:</label>
                <input type="text" formControlName="username" class="form-control" (keyup.tab)="isUserAvailable()"
                    (blur)="isUserAvailable()" id="username"
                    [ngClass]="{ 'is-invalid': !isUserValid || submitted && f.username.errors ||f.username.touched && f.username.errors || f.username.hasError('pattern')}" />
                <div *ngIf=" f.username.hasError('pattern')" class="invalid-feedback">
                    Uniquement des lettres et des chiffres
                </div>
                <p class="text-danger">{{usernameErrorMessage}}</p>
            </div>

            <!-- My Password -->
            <button [ngClass]="changePassword  ? 'text-danger' : 'text-success'" class="btn btn-block btn-light"
                (click)="onPasswordChange()">
                <a *ngIf="!changePassword">Modifier monmot de passe</a>
                <a *ngIf="changePassword">Ne pas modifier mon mot de passe</a>
            </button>
            <div *ngIf="changePassword">
                <div>
                    <div class="form-group">
                        <label for="myPassword">Mot de passe actuel:</label>
                        <input id="myPassword" formControlName="myPassword" type="password" class="form-control"
                            [ngClass]="f.myPassword.touched && f.myPassword.invalid ? 'is-invalid' : ''">
                        <label class="text-danger"
                            *ngIf="f.myPassword.value.length < 1 || f.myPassword.hasError('required')">
                            Confirmez votre mot de passe!
                        </label>
                    </div>
                </div>
    
                <div class="row">
                    <div class="col-sm">
                        <!-- Password -->
                        <div class="form-group">
                            <label for="password">Nouveau mot de passe:</label>
                            <input id="password" formControlName="password" type="password" class="form-control"
                                [ngClass]="f.password.touched && f.password.invalid ? 'is-invalid' : ''">
                            <label class="col"
                                [ngClass]="f.password.hasError('required') || f.password.hasError('minlength')  ? 'text-danger' : 'text-success'">
                                <i class="material-icons">{{ f.password.hasError('required') ||
                        f.password.hasError('minlength') ? 'cancel' :
                        'check_circle' }}</i>
                                Au moins 8 caractères
                            </label>
                            <label class="col"
                                [ngClass]="f.password.hasError('required') || f.password.hasError('hasNumber')  ? 'text-danger' : 'text-success'">
                                <i class="material-icons">{{ f.password.hasError('required') ||
                        f.password.hasError('hasNumber') ? 'cancel' :
                        'check_circle' }}</i>
                                Au moins un chiffre
                            </label>
                            <label class="col"
                                [ngClass]="f.password.hasError('required') || f.password.hasError('hasCapitalCase')  ? 'text-danger' : 'text-success'">
    
                                <i class="material-icons">{{ f.password.hasError('required') ||
                        f.password.hasError('hasCapitalCase') ? 'cancel' :
                        'check_circle' }}</i>
                                Au moins une majuscule
                            </label>
                            <label class="col"
                                [ngClass]="f.password.hasError('required') || f.password.hasError('hasSmallCase')  ? 'text-danger' : 'text-success'">
                                <i class="material-icons">{{ f.password.hasError('required') ||
                        f.password.hasError('hasSmallCase') ? 'cancel' :
                        'check_circle' }}</i>
                                Au moins une minuscule
                            </label>
                            <label class="col"
                                [ngClass]="f.password.hasError('required') || f.password.hasError('hasSpecialCharacters') ? 'text-danger' : 'text-success'">
                                <i class="material-icons">{{ f.password.hasError('required') ||
                        f.password.hasError('hasSpecialCharacters') ? 'cancel' :
                        'check_circle' }}</i>
                                Au moins un caractère spécial
                            </label>
                        </div>
                    </div>
                    <div class="col-sm">
                        <!-- Confirmation Password -->
                        <div class="form-group">
                            <label for="confirmPassword">Confirmez le nouveau mot de passe:</label>
                            <input id="confirmPassword" formControlName="confirmPassword" type="password"
                                class="form-control"
                                [ngClass]="f.confirmPassword.touched && f.confirmPassword.invalid ? 'is-invalid' : ''">
                            <label class="text-danger"
                                *ngIf="f.confirmPassword.value.length < 1 || f.confirmPassword.hasError('required')">
                                Confirmez votre mot de passe!
                            </label>
                            <label class="text-danger"
                                *ngIf="f.confirmPassword.value.length > 0 && f.confirmPassword.hasError('NoPassswordMatch')">
                                Les mots de passe doivent être identiques
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            </div>
           

        <div class="form-group pb-3 mt-3 text-center">
            <button [disabled]="loading" class="btn btn-primary btn-lg w-60 ">
                <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
                Enregistrer
            </button>
        </div>
    </form>

</div>
<p>
    Form is {{editRegisterForm.valid ? 'Valid' : 'Invalid'}}
</p>
<pre>Form Values: {{editRegisterForm.value | json}}</pre>