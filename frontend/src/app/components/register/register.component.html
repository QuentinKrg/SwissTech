<!-- Formulaire de création de compte-->
<div class="maindiv ">
    <h2 class="pt-3 text-center text-dark">Créer un compte</h2>
    <form (ngSubmit)="onSubmit()" [formGroup]="registerForm" class="form row justify-content-md-center">
        <div class="col-md-7">
            <!-- Mes coordonnées -->
            <div class=" m-3 p-4 shadow bg-white rounded ">
                <div>
                    <h5 class="mb-5 text-dark" >Mes coordonnées </h5>
                    <!-- Titre-->
                    <div class="form-group">
                        <!--<label for="CustomerTitle">Titre</label>-->
                        <select class="form-control input-border-bottom" formControlName="CustomerTitle" autofocus
                            [ngClass]="{ 'is-invalid': submitted && f.CustomerTitle.errors || f.CustomerTitle.touched && f.CustomerTitle.errors}">
                            <option value="" selected disabled>Titre</option>
                            <option value="2">Mme</option>
                            <option value="1">Mr</option>
                            <option value="3">Non binaire</option>
                        </select>
                    </div>

                    <!-- First name-->
                    <div class="row mb-4">
                        <div class="col-sm">
                            <div class="form-group">
                                <!--<label for="CustomerName">Prénom</label>-->
                                <input type="text" maxlength="100" formControlName="CustomerName" class="form-control input-border-bottom"
                                placeholder="Prénom"[ngClass]="{ 'is-invalid': submitted && f.CustomerName.errors || f.CustomerName.touched && f.CustomerName.errors}" />
                                <div class="invalid-feedback" *ngIf=" f.CustomerName.hasError('pattern')">
                                    Uniquement des lettres et des espaces</div>
                            </div>
                        </div>
                        <!-- Last name-->
                        <div class="col-sm">
                            <div class="form-group">
                                <!--<label for="CustomerLastName">Nom</label>-->
                                <input type="text" maxlength="100" formControlName="CustomerLastName"
                                    placeholder="Nom" class="form-control input-border-bottom"
                                    [ngClass]="{ 'is-invalid': submitted && f.CustomerLastName.errors || f.CustomerLastName.touched && f.CustomerLastName.errors}" />
                                <div class="invalid-feedback"
                                    *ngIf="submitted && f.CustomerLastName.hasError('pattern')">
                                    Uniquement des lettres et des espaces</div>
                            </div>
                        </div>

                    </div>

                    <!-- Birthday date-->
                    <div class="form-group">
                        <!--<label for="CustomerBirthday">Date de naissance</label>-->
                        <input onfocus="(this.type='date')" type="text" formControlName="CustomerBirthday"
                        placeholder="Date de naissance" class="form-control input-border-bottom" 
                            [ngClass]="{ 'is-invalid': submitted && f.CustomerBirthday.errors || f.CustomerBirthday.touched && f.CustomerBirthday.errors}" />
                    </div>




                </div>
                <!-- Adresse de livraison -->
                <h6 class="pt-3 mb-4 text-dark">
                    <svg class="f-icon " aria-hidden="true" role="img" focusable="false" height="20"
                        xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="icon_i_027_location">
                        <path fill="currentColor" d="M16 3.1a7.04 7.04 0 017.03 7.04c0 4.47-4.66 11.77-7.03 15.75-4-6.74-7.03-11.9-7.03-15.75A7.04
                     7.04 0 0116 3.1zM16 0C10.4 0 5.86 4.54 5.86 10.14S10.3 22.24 16 32c5.7-9.76 10.14-16.27 10.14-21.86S21.6
                      0 16 0zm0 6.52a3.52 3.52 0 100 7.04 3.52 3.52 0 000-7.04z">
                        </path>
                    </svg>
                    Adresse de livraison</h6>
                <div>
                    <!-- Adresse-->
                    <div class="form-group">
                        <input id="shippingAddress" type="text" formControlName="shippingAddress" class="form-control input-border-bottom"
                        placeholder="Rue, n°"[ngClass]="{ 'is-invalid': submitted && f.shippingAddress.errors || f.shippingAddress.touched && f.shippingAddress.errors}" />
                    </div>
                    <!-- Ville-->
                    <div class="row  mb-4">
                        <div class="col-sm">
                            <div class="form-group">
                                <input type="text" maxlength="100" formControlName="shippingCity" id="shippingCity"
                                    placeholder="Ville" class="form-control input-border-bottom"
                                    [ngClass]="{ 'is-invalid': submitted && f.shippingCity.errors  || f.shippingCity.touched && f.shippingCity.errors}" />
                            </div>
                        </div>
                        <!-- NPA-->
                        <div class="col-sm">
                            <div class="form-group">
                                <input maxlength="4" formControlName="shippingZip" class="form-control input-border-bottom" id="shippingZip"
                                placeholder="Code Postal" title="Min et Max 4 chiffres"
                                [ngClass]="{ 'is-invalid': submitted && f.shippingZip.errors ||
                                 f.shippingZip.errors && f.shippingZip.hasError('pattern') || f.shippingZip.touched && f.shippingZip.errors ||
                                 f.shippingZip.touched && f.shippingZip.hasError('minLength')}" />
                                <div class="invalid-feedback"
                                    *ngIf="f.shippingZip.touched && f.shippingZip.hasError('pattern') ">
                                    Uniquement des chiffres</div>
                                <div class="invalid-feedback"
                                    *ngIf="f.shippingZip.touched && f.shippingZip.value.length<4 && f.shippingZip.value.length!=0 ">
                                    Au moins 4 chiffres</div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Adresse de facturation -->
                <h6 class="pt-3 mb-4 text-dark">
                    <svg class="f-icon " aria-hidden="true" role="img" focusable="false" height="20"
                        xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="icon_i_017_postal_card">
                        <path fill="currentColor" d="M16.12 15.24L5.96 18.35l.4 1.33 10.16-3.12-.4-1.32zM27.25 4.08L32 19.57 4.75 27.92
                     0 12.43l27.25-8.35zm2.16 14.11L25.88 6.67 2.59 13.81l3.53 11.52 23.29-7.14zM7.3
                      22.77l10.16-3.11-.4-1.32-10.16 3.1.4 1.33zm18.76-11.6l-1-3.24-2.4.74.99 3.24 2.4-.74z">
                        </path>
                    </svg>
                    Adresse de facturation</h6>
                <div>
                    <div class="form-group mb-4 mt-4">
                        <div class="custom-control custom-checkbox">
                            <input [value]="true" name="checkbox_address" id="checkbox_address" type="checkbox"
                                class="custom-control-input input-border-bottom" formControlName="checkbox_address"
                                (change)="onSameAddressCheck()">
                            <label for="checkbox_address" class="custom-control-label">
                                Identique à l'adresse de livraison.
                            </label>
                        </div>
                    </div>
                    <!-- Adresse-->
                    <div class="form-group">
                        <input id="billingAddress" type="text" formControlName="billingAddress" class="form-control input-border-bottom"
                                placeholder="Rue, n°"[ngClass]="{ 'is-invalid': submitted && f.billingAddress.errors ||f.billingAddress.touched &&
                                 f.billingAddress.errors}" />
                    </div>
                    <!-- Ville-->
                    <div class="row mb-4">
                        <div class="col-sm">
                            <div class="form-group">
                                <input type="text" maxlength="100" formControlName="billingCity" id="billingCity"
                                placeholder="Ville" class="form-control input-border-bottom"
                                    [ngClass]="{ 'is-invalid': submitted && f.billingCity.errors ||f.billingCity.touched && f.billingCity.errors }" />
                            </div>
                        </div>
                        <!-- NPA-->
                        <div class="col-sm">
                            <div class="form-group">
                                <input maxlength="4" formControlName="billingZip" id="billingZip" class="form-control input-border-bottom"
                                title="Min et Max 4 chiffres" placeholder="Code Postal" [ngClass]="{ 'is-invalid': submitted && f.billingZip.errors ||
                             f.billingZip.touched && f.billingZip.hasError('pattern')
                             || f.billingZip.touched && f.billingZip.errors ||
                             f.billingZip.touched && f.billingZip.hasError('minLength')}" />
                                <div class="invalid-feedback" *ngIf="f.billingZip.touched && f.billingZip.hasError('pattern') ||
                         f.billingZip.errors && f.billingZip.hasError('pattern')">
                                    Uniquement des chiffres</div>
                                <div class="invalid-feedback"
                                    *ngIf="f.billingZip.touched && f.billingZip.value.length<4 && f.billingZip.value.length!=0 ">
                                    Au moins 4 chiffres</div>
                            </div>
                        </div>
                    </div>
                </div>
                <h5 class="mb-5 text-dark">Mes informations de contact</h5>
                <div>
                    <!-- Email -->
                    <div class="form-group">
                        <input type="CustomerEmail" formControlName="CustomerEmail" class="form-control input-border-bottom"
                            placeholder="E-mail:      exemple@domaine.com"
                            [ngClass]="{ 'is-invalid': submitted && f.CustomerEmail.errors || f.CustomerEmail.touched && f.CustomerEmail.errors}" />
                        <div class="invalid-feedback"
                            *ngIf="submitted && f.CustomerEmail.hasError('CustomerEmail') || f.CustomerEmail.touched && f.CustomerEmail.hasError('CustomerEmail')">
                            Le format de la saisie n'est pas valable
                        </div>
                    </div>
                    <!-- Private phone-->
                    <div class="form-group">
                        <input type="phone" formControlName="CustomerPhone" class="form-control input-border-bottom"
                            placeholder="Téléphone:        Exemple:  +41 12 345 67 89" [ngClass]="{ 'is-invalid': submitted && f.CustomerPhone.errors || f.CustomerPhone.touched && f.CustomerPhone.errors || 
                            f.CustomerPhone.touched && f.CustomerPhone.hasError('pattern')}" />
                        <div class="invalid-feedback" *ngIf="submitted && f.CustomerPhone.hasError('pattern') ||
                             f.CustomerPhone.touched && f.CustomerPhone.hasError('pattern')">
                            Le format de la saisie n'est pas valable
                        </div>
                    </div>
                </div>
            <!-- Identifiants-->
                <div>
                    <h5 class="mb-5 text-dark">Mes identifiants </h5>
                    <!-- username -->
                    <div class="form-group">
                        <input type="text" formControlName="Username" class="form-control input-border-bottom"
                        placeholder="Nom d'utilisateur:  Exemple  Swisstech" (keyup.tab)="isUserAvailable()" (blur)="isUserAvailable()"
                            [ngClass]="{ 'is-invalid': !isUserValid || submitted && f.Username.errors ||f.Username.touched && f.Username.errors || f.Username.hasError('pattern')}" />
                        <div *ngIf=" f.Username.hasError('pattern')" class="invalid-feedback">
                            Uniquement des lettres et des chiffres
                        </div>
                        <p class="text-danger">{{usernameErrorMessage}}</p>
                    </div>

                    <div class="row mb-4">
                        <div class="col-sm">
                            <!-- Password -->
                            <div class="form-group">
                                <input id="password" formControlName="password" type="password" class="form-control input-border-bottom"
                                placeholder="Mot de passe" [ngClass]="f.password.touched && f.password.invalid ? 'is-invalid' : ''">
                                <div class="mt-2">
                                    <label class="col pr-0"
                                        [ngClass]="f.password.hasError('required') || f.password.hasError('minlength')  ? 'text-danger' : 'text-success'">
                                        <fa-icon *ngIf=" f.password.hasError('required') ||
                                            f.password.hasError('minlength'); else elseBlock1" [icon]="faTimesCircle" size="lg"
                                            class="text-danger"></fa-icon>
                                        <ng-template #elseBlock1>
                                            <fa-icon [icon]="faCheckCircle" size="lg" class="text-success"></fa-icon>
                                        </ng-template>
            
                                        Au moins 8 caractères
                                    </label>
                                    <label class="col pr-0"
                                        [ngClass]="f.password.hasError('required') || f.password.hasError('hasNumber')  ? 'text-danger' : 'text-success'">
                                        <fa-icon *ngIf=" f.password.hasError('required') ||
                                        f.password.hasError('hasNumber'); else elseBlock2" [icon]="faTimesCircle" size="lg"
                                            class="text-danger"></fa-icon>
                                        <ng-template #elseBlock2>
                                            <fa-icon [icon]="faCheckCircle" size="lg" class="text-success"></fa-icon>
                                        </ng-template>
                                        Au moins un chiffre
                                    </label>
                                    <label class="col pr-0"
                                        [ngClass]="f.password.hasError('required') || f.password.hasError('hasCapitalCase')  ? 'text-danger' : 'text-success'">
                                        <fa-icon *ngIf=" f.password.hasError('required') ||
                                        f.password.hasError('hasCapitalCase'); else elseBlock3" [icon]="faTimesCircle" size="lg"
                                            class="text-danger"></fa-icon>
                                        <ng-template #elseBlock3>
                                            <fa-icon [icon]="faCheckCircle" size="lg" class="text-success"></fa-icon>
                                        </ng-template>
                                        Au moins une majuscule
                                    </label>
                                    <label class="col pr-0"
                                        [ngClass]="f.password.hasError('required') || f.password.hasError('hasSmallCase')  ? 'text-danger' : 'text-success'">
                                        <fa-icon *ngIf=" f.password.hasError('required') ||
                                        f.password.hasError('hasSmallCase'); else elseBlock4" [icon]="faTimesCircle" size="lg"
                                            class="text-danger"></fa-icon>
                                        <ng-template #elseBlock4>
                                            <fa-icon [icon]="faCheckCircle" size="lg" class="text-success"></fa-icon>
                                        </ng-template>
                                        Au moins une minuscule
                                    </label>
                                    <label class="col pr-0"
                                        [ngClass]="f.password.hasError('required') || f.password.hasError('hasSpecialCharacters') ? 'text-danger' : 'text-success'">
                                        <fa-icon *ngIf=" f.password.hasError('required') ||
                                        f.password.hasError('hasSpecialCharacters'); else elseBlock5" [icon]="faTimesCircle"
                                            size="lg" class="text-danger"></fa-icon>
                                        <ng-template #elseBlock5>
                                            <fa-icon [icon]="faCheckCircle" size="lg" class="text-success"></fa-icon>
                                        </ng-template>
                                        Au moins un caractère spécial
                                    </label>
                                </div>

                            </div>
                        </div>
                        <div class="col-sm">
                            <!-- Confirmation Password -->
                            <div class="form-group">
                                <input id="confirmPassword" formControlName="confirmPassword" type="password"
                                    class="form-control input-border-bottom" placeholder="Confirmer le mot de passe"
                                    [ngClass]="f.confirmPassword.touched && f.confirmPassword.invalid ? 'is-invalid' : ''">
                                <label class="text-danger"
                                    *ngIf="f.confirmPassword.value.length < 1 || f.confirmPassword.hasError('required')">
                                    Confirmez votre mot de passe!
                                </label>
                                <label class="text-danger"
                                    *ngIf="f.confirmPassword.value.length > 0 && f.confirmPassword.hasError('NoPassswordMatch')">
                                    Les mots de passe doivent être identiques
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
            <!-- Checkbox general condition-->
            <div class="form-group border-top m-3 pt-3">
                <div class="custom-control custom-checkbox">
                    <input id="checkbox_register" type="checkbox" class="custom-control-input"
                        formControlName="generalConditions"
                        [ngClass]="{ 'is-invalid': submitted && !registerForm.value.generalConditions}">
                    <label for="checkbox_register" class="custom-control-label text-dark">
                        J'accepte les Conditions générales.
                    </label>
                </div>
            </div>
            <!-- CAPTCHA-->
            <div class=" m-3" title="Merci de respecter la casse">
                <div class="row mb-4">
                    <div class="col-sm-6 text-center">
                        <div class="row w-60 mx-auto text-center">
                            <div class="col-auto">
                                <canvas id="myCanvas" width="180" height="45" class="rounded text-dark">
                                    Your browser does not support the HTML5 canvas tag, please try another browser.</canvas>
                            </div>
                            <div class="col-auto p-0 text-baseline">
                                <button id="MyButton" type="button" class="btn btn-light align-baseline h-20"
                                    (click)="onRefresh() ">
                                    <h4 class="m-auto text-primary">
                                        <fa-icon [icon]="faSyncAlt" class="align-baseline"></fa-icon>
                                    </h4>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-5 ">
                        <div class="form-group mw-42">
                            <input class="form-control input-border-bottom" formControlName="userEnteredCaptcha"
                                placeholder="Inserez le code de l'image" type="text" [maxlength]="6" [ngClass]="{ 'is-invalid': f.userEnteredCaptcha.touched &&  f.userEnteredCaptcha.errors ||
                    submitted && f.userEnteredCaptcha.errors || submitted && !isValid(f.userEnteredCaptcha.value) }" />
        
                            <div *ngIf="submitted &&  f.userEnteredCaptcha.errors ||
                 f.userEnteredCaptcha.touched &&  f.userEnteredCaptcha.errors" class="invalid-feedback">
                                Veuillez saisir les caractères de l'image
                            </div>
        
                            <div *ngIf="submitted && !isValid(f.userEnteredCaptcha.value)" class="invalid-feedback">
                                Le captcha est invalide
                            </div>
                        </div>
                    </div>
                </div>   

            </div>
            <!-- Fin du formulaire et envoie-->
            <div class="form-group pb-3 mt-3 text-center">
                <button [disabled]="loading" class="btn btn-primary btn-lg w-60 ">
                    <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
                    Inscrivez-vous
                </button>
            </div>
        </div>
    </form>

</div>